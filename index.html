<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeLife</title>
</head>
<body style="background-image: url('/bg.png'); background-repeat: no-repeat; background-size: cover;">
    <center><h1 style="color: grey">SafeLife</h1></center>
    <div><input id="smashanpass" /></div>
    <button onclick="getData()">Proxy</button>
    <div id="output"></div>

    <script>
        var lastRemadeURL = '';
        var url = null;

        // Function to fetch content using proxy
        function fetchData(url) {
            lastRemadeURL = url;
            fetch(`http://127.0.0.1:5000/api/proxy?url=${encodeURIComponent(url)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.content) {
                        document.open();
                        document.write(data.content);
                        document.close();
                        // Perform additional actions if needed
                    } else {
                        document.getElementById('output').innerHTML = '<p style="color: red;">The site does not exist or could not be fetched.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('output').innerHTML = '<p style="color: red;">Error fetching content.</p>';
                });
        }

        // Function to handle form submission
        function getData() {
            var inputElement = document.getElementById('smashanpass');
            url = inputElement.value.trim(); // Trim whitespace
            
            if (url) {
                fetchData(url);
            } else {
                document.getElementById('output').innerHTML = '<p style="color: red;">Please enter a valid URL.</p>';
            }
        }

        // Function to check for new links every second
        // Function to check for new links every second
        // Function to check for new links every second
// Define a global variable to store the last remade URL
        

        // Function to check for new links every second
        setInterval(function() {
            var links = document.getElementsByTagName('a');
            for (var i = 0; i < links.length; i++) {
                if (!links[i].hasAttribute('data-handled')) {
                    links[i].setAttribute('data-handled', true); // Mark link as handled
                    links[i].addEventListener('click', function(event) {
                        event.preventDefault(); // Prevent the default link behavior
                        var urlsd = this.href;
                        if (urlsd.includes(lastRemadeURL)) {
                            console.log("u good bro");
                        }
                        else {
                            let currentUrl = window.location.href;
                            console.log(currentUrl);
                            // Construct full URL using base URL and last part of href
                            urlsd = lastRemadeURL + '/' + urlsd;
                            urlsd.replace(currentUrl, "");
                             // Store the last remade URL in the global variable
                            console.log("Attemptus petronum");
                            console.log(urlsd);
                        }
                        fetchData(urlsd); // Fetch content using proxy
                    });
                }
            }
        }, 1000); // Check every second (1000 milliseconds)



    </script>
</body>
</html>
